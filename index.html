<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ShopManage - Product Management System</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark modern-nav">
        <div class="container">
            <a href="#" class="navbar-brand brand-logo">
                <div class="logo-icon">
                    <i class="bi bi-shop"></i>
                </div>
                <span class="brand-text">ShopManage</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto me-4">
                    <li class="nav-item"><a class="nav-link active" href="#"><i class="bi bi-grid me-1"></i>Products</a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-tags me-1"></i>Categories</a></li>
                    <li class="nav-item"><a class="nav-link" href="#"><i class="bi bi-graph-up me-1"></i>Reports</a></li>
                </ul>
                <div class="d-flex align-items-center gap-3 flex-wrap">
                    <button class="btn btn-gradient-primary px-4" type="button" onclick="openAddModal()">
                        <i class="bi bi-plus-circle me-2"></i>Add Product
                    </button>
                    <form class="search-form" onsubmit="return false;">
                        <div class="search-wrapper">
                            <i class="bi bi-search search-icon"></i>
                            <input class="search-input" id="searchInput" type="search" placeholder="Search products..." aria-label="Search">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container main-container mt-4">
        <!-- Page Header -->
        <header class="row mb-4">
            <div class="col-12">
                <div class="page-header-card">
                    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                        <div>
                            <h1 class="h3 mb-2 fw-bold">Product Management</h1>
                            <p class="text-muted mb-0"><i class="bi bi-layers me-2"></i>Manage your inventory and product catalog</p>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Product Statistics -->
        <section class="row stats-section mb-4">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="modern-stats-card gradient-blue">
                    <div class="stats-content">
                        <div class="stats-icon"><i class="bi bi-box-seam"></i></div>
                        <div class="stats-info">
                            <h5 class="stats-label">Total Products</h5>
                            <p class="stats-value" id="totalProducts">0</p>
                        </div>
                    </div>
                    <div class="stats-bg-icon"><i class="bi bi-box-seam"></i></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="modern-stats-card gradient-green">
                    <div class="stats-content">
                        <div class="stats-icon"><i class="bi bi-check-circle"></i></div>
                        <div class="stats-info">
                            <h5 class="stats-label">In Stock</h5>
                            <p class="stats-value" id="inStock">0</p>
                        </div>
                    </div>
                    <div class="stats-bg-icon"><i class="bi bi-check-circle"></i></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="modern-stats-card gradient-orange">
                    <div class="stats-content">
                        <div class="stats-icon"><i class="bi bi-exclamation-triangle"></i></div>
                        <div class="stats-info">
                            <h5 class="stats-label">Low Stock</h5>
                            <p class="stats-value" id="lowStock">0</p>
                        </div>
                    </div>
                    <div class="stats-bg-icon"><i class="bi bi-exclamation-triangle"></i></div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="modern-stats-card gradient-red">
                    <div class="stats-content">
                        <div class="stats-icon"><i class="bi bi-x-circle"></i></div>
                        <div class="stats-info">
                            <h5 class="stats-label">Out of Stock</h5>
                            <p class="stats-value" id="outOfStock">0</p>
                        </div>
                    </div>
                    <div class="stats-bg-icon"><i class="bi bi-x-circle"></i></div>
                </div>
            </div>
        </section>

        <!-- Product Listing -->
        <section class="row" id="productList">
            <div class="col-12">
                <div class="card border-0 shadow-sm" style="border-radius: 16px;">
                    <div class="card-header bg-white p-4 border-bottom-0 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0 fw-bold"><i class="bi bi-grid-3x3-gap me-2"></i>Product Catalog</h5>
                        <div class="btn-group" role="group">
                            <input type="radio" class="btn-check" name="viewToggle" id="cardView" checked autocomplete="off">
                            <label class="btn btn-outline-secondary btn-sm" for="cardView"><i class="bi bi-grid-3x3-gap"></i></label>
                            <input type="radio" class="btn-check" name="viewToggle" id="tableView" autocomplete="off">
                            <label class="btn btn-outline-secondary btn-sm" for="tableView"><i class="bi bi-table"></i></label>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        <!-- Loading -->
                        <div id="loadingSpinner" class="text-center py-5 d-none">
                            <div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div>
                        </div>

                        <!-- Card Grid -->
                        <div id="cardContainer" class="row g-4"></div>

                        <!-- Table View -->
                        <div id="tableContainer" class="d-none">
                            <div class="table-responsive">
                                <table class="table modern-table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Image</th>
                                            <th>Product</th>
                                            <th>Category</th>
                                            <th>Price</th>
                                            <th>Stock</th>
                                            <th class="text-end">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Empty State -->
                        <div id="emptyState" class="text-center py-5 d-none">
                            <div class="mb-3 text-muted" style="font-size: 3rem;"><i class="bi bi-inbox"></i></div>
                            <h4>No Products Found</h4>
                            <p class="text-muted">Start by adding your first product.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Add/Edit Product Modal -->
    <div class="modal fade" id="productModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content modern-modal">
                <div class="modal-header modern-modal-header">
                    <h5 class="modal-title" id="productModalLabel">Add New Product</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body modern-modal-body">
                    <form id="productForm">
                        <!-- Hidden Input for ID -->
                        <input type="hidden" id="editProductId" value="">
                        
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label fw-bold">Product Title</label>
                                <input type="text" class="form-control form-control-modern" id="productTitle" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Price</label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-0">$</span>
                                    <input type="number" class="form-control form-control-modern" id="productPrice" step="0.01" min="0" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Category</label>
                                <select class="form-select form-control-modern" id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="Electronics">Electronics</option>
                                    <option value="Clothing">Clothing</option>
                                    <option value="Books">Books</option>
                                    <option value="Home">Home & Garden</option>
                                    <option value="Beauty">Beauty & Health</option>
                                    <option value="Sports">Sports & Outdoors</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <label class="form-label fw-bold">Image URL</label>
                                <input type="url" class="form-control form-control-modern" id="productImage" placeholder="https://">
                            </div>
                            <!-- Image Preview -->
                            <div class="col-12 d-none" id="imagePreviewContainer">
                                <div class="image-preview-card">
                                    <img id="imagePreview" src="" alt="Preview" class="preview-image">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">Stock Quantity</label>
                                <input type="number" class="form-control form-control-modern" id="productStock" min="0" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label fw-bold">SKU</label>
                                <input type="text" class="form-control form-control-modern" id="productSku" placeholder="Auto-generated if empty">
                            </div>
                        </div>
                        <div class="mt-4 text-end">
                            <button type="button" class="btn btn-light me-2" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-gradient-primary">Save Product</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // --- SAFE DEFAULT DATA ---
        // We initialize with data so something always shows, even if storage fails.
        const defaultData = [
            {
                id: 1,
                title: "Wireless Headphones",
                price: "99.99",
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&q=80",
                stock: 15,
                sku: "AUDIO-001"
            },
            {
                id: 2,
                title: "Running Shoes",
                price: "79.50",
                category: "Sports",
                image: "https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=500&q=80",
                stock: 5,
                sku: "SPORT-002"
            },
            {
                id: 3,
                title: "Minimalist Watch",
                price: "120.00",
                category: "Clothing",
                image: "https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=500&q=80",
                stock: 0,
                sku: "TIME-003"
            },
            {
                id: 4,
                title: "Smart Speaker Home",
                price: "49.99",
                category: "Home",
                image: "https://images.unsplash.com/photo-1589492477829-5e65395b66cc?w=500&q=80",
                stock: 22,
                sku: "HOME-004"
            },
            {
                id: 5,
                title: "Premium Yoga Mat",
                price: "29.95",
                category: "Sports",
                image: "https://images.unsplash.com/photo-1601925260368-ae2f83cf8b7f?w=500&q=80",
                stock: 8,
                sku: "YOGA-005"
            },
            {
                id: 6,
                title: "Ceramic Coffee Set",
                price: "65.00",
                category: "Home",
                image: "https://images.unsplash.com/photo-1567748154382-72352885971a?w=500&q=80",
                stock: 12,
                sku: "COFFEE-006"
            },
            {
                id: 7,
                title: "Gaming Mouse RGB",
                price: "45.00",
                category: "Electronics",
                image: "https://images.unsplash.com/photo-1527814050087-3793815479db?w=500&q=80",
                stock: 4,
                sku: "GAME-007"
            },
            {
                id: 8,
                title: "Organic Face Oil",
                price: "32.00",
                category: "Beauty",
                image: "https://images.unsplash.com/photo-1608248597279-f99d160bfbc8?w=500&q=80",
                stock: 25,
                sku: "BEAUTY-008"
            }
        ];

        let products = [...defaultData]; // Start with defaults
        
        // --- CRITICAL CHANGE: UPDATED STORAGE KEY ---
        // Changed from '_v2' to '_v3' to ignore old cached data (the 3 items)
        // and force the new defaultData (8 items) to load.
        const STORAGE_KEY = 'shopManage_products_v3'; 

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            setupEventListeners();
        });

        // --- Core Functions ---

        function loadProducts() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const parsed = JSON.parse(stored);
                    if (Array.isArray(parsed) && parsed.length > 0) {
                        products = parsed; // Only overwrite if we found valid data
                    }
                } else {
                    // Nothing in storage? Save our defaults so they persist next time
                    saveProducts();
                }
            } catch(e) {
                console.warn("LocalStorage access denied or error. Using default in-memory data.", e);
                // We don't change 'products' here, so it keeps the defaultData
            }
            
            renderProducts();
            updateStats();
        }

        function saveProducts() {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(products));
            } catch(e) {
                console.warn("Could not save to localStorage. Data will reset on reload.", e);
            }
            updateStats();
            renderProducts();
        }

        // --- Render Logic ---

        function renderProducts(filterText = '') {
            const cardContainer = document.getElementById('cardContainer');
            const tableBody = document.getElementById('productTableBody');
            const emptyState = document.getElementById('emptyState');
            
            if (!cardContainer || !tableBody || !emptyState) return;

            cardContainer.innerHTML = '';
            tableBody.innerHTML = '';

            const filteredProducts = products.filter(p => 
                p.title.toLowerCase().includes(filterText.toLowerCase()) || 
                p.category.toLowerCase().includes(filterText.toLowerCase())
            );

            if (filteredProducts.length === 0) {
                emptyState.classList.remove('d-none');
            } else {
                emptyState.classList.add('d-none');
            }

            filteredProducts.forEach(product => {
                // 1. Render Card
                const cardCol = document.createElement('div');
                cardCol.className = 'col-md-6 col-lg-4 col-xl-3';
                cardCol.innerHTML = `
                    <div class="product-card">
                        <div class="product-img-wrapper">
                            <img src="${product.image || 'https://via.placeholder.com/300x200?text=No+Image'}" 
                                 class="product-img" 
                                 onerror="this.src='https://via.placeholder.com/300x200?text=Error'" 
                                 alt="${product.title}">
                            <div class="card-actions">
                                <button class="action-btn edit" onclick="editProduct(${product.id})">
                                    <i class="bi bi-pencil"></i>
                                </button>
                                <button class="action-btn delete" onclick="deleteProduct(${product.id})">
                                    <i class="bi bi-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="product-details">
                            <span class="product-category">${product.category}</span>
                            <h5 class="product-title" title="${product.title}">${product.title}</h5>
                            <div class="d-flex justify-content-between align-items-center mt-3">
                                <span class="product-price">$${parseFloat(product.price).toFixed(2)}</span>
                                ${getStockBadge(product.stock)}
                            </div>
                        </div>
                    </div>
                `;
                cardContainer.appendChild(cardCol);

                // 2. Render Table Row
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>
                        <img src="${product.image || 'https://via.placeholder.com/50?text=Img'}" 
                             class="table-img" 
                             onerror="this.src='https://via.placeholder.com/50?text=Error'">
                    </td>
                    <td>
                        <div class="fw-bold text-dark">${product.title}</div>
                        <small class="text-muted">SKU: ${product.sku}</small>
                    </td>
                    <td><span class="badge bg-light text-dark border">${product.category}</span></td>
                    <td class="fw-bold">$${parseFloat(product.price).toFixed(2)}</td>
                    <td>${getStockBadge(product.stock)}</td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editProduct(${product.id})">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        function getStockBadge(stock) {
            stock = parseInt(stock);
            if (stock === 0) return '<span class="stock-badge bg-stock-red">Out of Stock</span>';
            if (stock < 10) return '<span class="stock-badge bg-stock-orange">Low: ' + stock + '</span>';
            return '<span class="stock-badge bg-stock-green">In Stock: ' + stock + '</span>';
        }

        function updateStats() {
            document.getElementById('totalProducts').textContent = products.length;
            document.getElementById('inStock').textContent = products.filter(p => parseInt(p.stock) >= 10).length;
            document.getElementById('lowStock').textContent = products.filter(p => parseInt(p.stock) > 0 && parseInt(p.stock) < 10).length;
            document.getElementById('outOfStock').textContent = products.filter(p => parseInt(p.stock) === 0).length;
        }

        // --- Event Listeners ---

        function setupEventListeners() {
            // View Toggles
            document.getElementById('cardView').addEventListener('change', () => {
                document.getElementById('cardContainer').classList.remove('d-none');
                document.getElementById('tableContainer').classList.add('d-none');
            });
            
            document.getElementById('tableView').addEventListener('change', () => {
                document.getElementById('cardContainer').classList.add('d-none');
                document.getElementById('tableContainer').classList.remove('d-none');
            });

            // Search
            const searchInput = document.getElementById('searchInput');
            if(searchInput) {
                searchInput.addEventListener('input', (e) => {
                    renderProducts(e.target.value);
                });
            }

            // Image Preview
            const imgInput = document.getElementById('productImage');
            if(imgInput) {
                imgInput.addEventListener('input', (e) => {
                    const url = e.target.value;
                    const container = document.getElementById('imagePreviewContainer');
                    const img = document.getElementById('imagePreview');
                    if (url) {
                        container.classList.remove('d-none');
                        img.src = url;
                        img.onerror = () => { container.classList.add('d-none'); };
                    } else {
                        container.classList.add('d-none');
                    }
                });
            }

            // Form Submit
            const form = document.getElementById('productForm');
            if(form) {
                form.addEventListener('submit', handleFormSubmit);
            }
        }

        // --- Actions ---

        function openAddModal() {
            document.getElementById('productForm').reset();
            document.getElementById('editProductId').value = ""; 
            document.getElementById('imagePreviewContainer').classList.add('d-none');
            document.getElementById('productModalLabel').textContent = "Add New Product";
            
            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        function editProduct(id) {
            // Type safety check
            const product = products.find(p => String(p.id) === String(id));
            if (!product) return;

            document.getElementById('productTitle').value = product.title;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productImage').value = product.image;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productSku').value = product.sku;

            if(product.image) {
                document.getElementById('imagePreview').src = product.image;
                document.getElementById('imagePreviewContainer').classList.remove('d-none');
            } else {
                document.getElementById('imagePreviewContainer').classList.add('d-none');
            }

            document.getElementById('editProductId').value = product.id;
            
            document.getElementById('productModalLabel').textContent = "Edit Product";
            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            
            const title = document.getElementById('productTitle').value;
            const price = document.getElementById('productPrice').value;
            const category = document.getElementById('productCategory').value;
            const image = document.getElementById('productImage').value;
            const stock = document.getElementById('productStock').value;
            let sku = document.getElementById('productSku').value;
            const editId = document.getElementById('editProductId').value; 

            if (!sku) sku = 'SKU-' + Date.now().toString().slice(-6);

            if (editId) {
                const index = products.findIndex(p => String(p.id) === String(editId));
                if (index !== -1) {
                    products[index] = {
                        id: parseInt(editId), // maintain ID consistency
                        title, price, category, image, stock, sku
                    };
                }
            } else {
                const newProduct = {
                    id: Date.now(),
                    title, price, category, image, stock, sku
                };
                products.push(newProduct);
            }

            saveProducts();
            
            const modalEl = document.getElementById('productModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();
        }

        function deleteProduct(id) {
            if(confirm("Are you sure you want to delete this product?")) {
                products = products.filter(p => String(p.id) !== String(id));
                saveProducts();
            }
        }
    </script>
</body>
</html>